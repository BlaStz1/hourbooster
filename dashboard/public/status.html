<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Status | Hour Booster</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="styles.css" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-[#0e0e10] text-white font-sans [&::-webkit-scrollbar]:w-2 [&::-webkit-scrollbar-track]:rounded-full [&::-webkit-scrollbar-thumb]:rounded-full [&::-webkit-scrollbar-thumb]:bg-red-500">

  <!-- Navbar -->

  <!-- Navbar -->
    <nav class="fixed w-full z-50 top-0">
    <div class="nav-blur bg-[#0e0e10] border-b border-white/10">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between h-20">
          <div class="flex items-center gap-2">
            <span class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-red-500 to-red-700">Hour
              Booster</span>
          </div>

          <div class="md:hidden">
            <button onclick="toggleMobileMenu()" class="text-white p-2">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path class="menu-icon" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M4 6h16M4 12h16M4 18h16"></path>
              </svg>
            </button>
          </div>

          <div class="hidden md:flex gap-4">
            <a href="/status">
              <button
                class="bg-white/10 hover:bg-white/20 px-6 py-2 rounded-lg transition-all duration-300">Status</button>
            </a>
            <a href="/dashboard">
              <button
                class="bg-white/10 hover:bg-white/20 px-6 py-2 rounded-lg transition-all duration-300">Dashboard</button>
            </a>
            <a href="/leaderboard">
              <button
                class="bg-white/10 hover:bg-white/20 px-6 py-2 rounded-lg transition-all duration-300">Leaderboard</button>
            </a>
          </div>

          <div id="mobileMenu" class="hidden md:hidden">
            <div class="px-2 pt-2 pb-3 space-y-1 bg-black/50 rounded-lg mt-2">
              <a href="#hero" class="block px-3 py-2 text-white/70 hover:text-white transition-colors">Home</a>
              <a href="#features" class="block px-3 py-2 text-white/70 hover:text-white transition-colors">Features</a>
              <a href="#commands" class="block px-3 py-2 text-white/70 hover:text-white transition-colors">Commands</a>
            </div>
          </div>
        </div>
      </div>
  </nav>

  <!-- Main Content -->
  <main class="pt-32 px-6 max-w-6xl mx-auto">
    <header class="text-center mb-10">
      <h1 class="text-5xl font-extrabold bg-gradient-to-r from-red-500 to-pink-500 text-transparent bg-clip-text drop-shadow">Hour Booster Status</h1>
      <p class="text-lg text-white/70 mt-2">Live updates about outages, bugs, maintenance, and recoveries.</p>
    </header>

    <!-- Stats Overview -->
    <div id="stats-overview" class="mb-8 grid sm:grid-cols-2 gap-4 text-sm text-white/80"></div>

    <!-- Status Feed -->
    <div id="status-feed" class="space-y-6"></div>
  </main>


  <!-- JavaScript -->
  <script>
    async function fetchStatus() {
      const res = await fetch('/api/status');
      const data = await res.json();
      const feed = document.getElementById('status-feed');
      const stats = document.getElementById('stats-overview');
      feed.innerHTML = '';
      stats.innerHTML = '';

      if (data.systemInfo) {
        const { cpuUsage, ramUsage, diskUsage, uptime, host } = data.systemInfo;
        stats.innerHTML = `
          <div class="p-4 rounded border border-white/10">
            <div class="font-semibold text-white">System Host</div>
            <div>${host || 'Unknown'}</div>
          </div>
          <div class="p-4 rounded border border-white/10">
            <div class="font-semibold text-white">Uptime</div>
            <div>${uptime || '—'}</div>
          </div>
          <div class="p-4 rounded border border-white/10">
            <div class="font-semibold text-white">CPU Usage</div>
            <div class="text-green-400 font-semibold text-xl">${cpuUsage}%</div>
          </div>
          <div class="p-4 rounded border border-white/10">
            <div class="font-semibold text-white">RAM Usage</div>
            <div class="text-green-400 font-semibold text-xl">${ramUsage}%</div>
          </div>
        `;
      }

      const updates = [...data.updates];
      const unresolved = updates.filter(u => !u.resolved).sort((a, b) => new Date(b.time) - new Date(a.time));
      const resolved   = updates.filter(u =>  u.resolved).sort((a, b) => new Date(b.time) - new Date(a.time));

      const severityMap = {
        none:   { border: 'border-grey-500',  text: 'text-grey-400',  dot: 'bg-grey-400', resolved: "text-gray-400", level: "No Severity" },
        low:    { border: 'border-green-500',  text: 'text-green-400',  dot: 'bg-green-400', resolved: "text-gray-400", level: "Low Severity" },
        medium: { border: 'border-yellow-500', text: 'text-yellow-400', dot: 'bg-yellow-400', resolved: "text-gray-400", level: "Medium Severity" },
        high:   { border: 'border-red-600',    text: 'text-red-400',    dot: 'bg-red-500', resolved: "text-gray-400", level: "High Severity" }
      };

      function renderCard(u) {
        const baseSev = severityMap[u.severity] || { border: 'border-white/10', text: 'text-white/60', dot: 'bg-white/40', resolved: 'text-gray-400' };
        const borderClass = u.resolved ? 'border-gray-600' : baseSev.border;
        const textClass = u.resolved ? 'text-gray-300' : 'text-white';
        const dotClass = u.resolved ? 'bg-gray-400' : baseSev.dot;
        const statusText = u.resolved
          ? `<span class="text-gray-400">Resolved</span>`
          : `<span class="${baseSev.text} animate-pulse">Ongoing</span>`;
        const severityLabel = u.resolved ? '' : ` - (${baseSev.level})`;

        const timeline = (u.timeline || []).map(entry => `
          <div class="text-sm text-white/70">
            <span class="text-white/40 capitalize">${entry.subtype}</span> — ${entry.message}
          </div>
        `).join('');

        return `
          <div class="p-4 rounded-lg border ${borderClass} space-y-2">
            <div class="flex justify-between items-center">
              <div class="flex items-center gap-2 text-xs">
                <span class="${dotClass} w-2 h-2 rounded-full"></span>
                ${statusText}<span class="font-semibold">${severityLabel}</span>
              </div>
              <span class="text-xs text-white/50">${new Date(u.time).toLocaleString()}</span>
            </div>
            <div class="${textClass} text-sm">${u.message}</div>
            ${u.affects?.length ? `<div class="text-xs text-white/50">Affects: ${u.affects.join(', ')}</div>` : ''}
            ${timeline}
          </div>
        `;
      }

      if (unresolved.length) {
        feed.innerHTML += `<h2 class="text-xl font-bold text-white mb-2">Open Issues</h2>`;
        unresolved.forEach(u => {
          feed.innerHTML += renderCard(u);
        });
      }

if (resolved.length) {
  feed.innerHTML += `
    <div class="mt-8">
      <button onclick="toggleResolved()" class="flex items-center gap-2 text-xl font-bold text-white hover:text-red-400 transition">
        <svg id="resolved-icon" class="w-5 h-5 transition-transform duration-200" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
        </svg>
        Resolved
      </button>
      <div id="resolved-container" class="mt-2 space-y-6" style="display: none;">
        ${resolved.map(u => renderCard(u)).join('')}
      </div>
    </div>
  `;
}

    }

    function toggleResolved() {
  const container = document.getElementById('resolved-container');
  const icon = document.getElementById('resolved-icon');
  if (container.style.display === 'none') {
    container.style.display = 'block';
    icon.style.transform = 'rotate(0deg)';
  } else {
    container.style.display = 'none';
    icon.style.transform = 'rotate(-90deg)';
  }
}


    fetchStatus();
    setInterval(fetchStatus, 60000);
  </script>
  <footer class="text-white py-16 border-t border-white/10 mt-20">
    <div class="max-w-7xl mx-auto text-center">
      <p class="text-sm text-white/40">© 2025 Hour Booster</p>
    </div>
  </footer>

</body>
</html>
