<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Leaderboard | Hour Booster</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="js/script.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
</head>
<body class="bg-[#0e0e10] text-white font-sans [&::-webkit-scrollbar]:w-2 [&::-webkit-scrollbar-track]:rounded-full [&::-webkit-scrollbar-thumb]:rounded-full [&::-webkit-scrollbar-thumb]:bg-red-500">
  <!-- Loader -->
  <div id="loader" class="fixed inset-0 bg-black z-50 flex items-center justify-center">
    <div class="w-12 h-12 border-4 border-red-500 border-t-transparent rounded-full animate-spin"></div>
  </div>

  <!-- Navbar -->
    <nav class="fixed w-full z-50 top-0">
    <div class="nav-blur bg-[#0e0e10] border-b border-white/10">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between h-20">
          <div class="flex items-center gap-2">
            <span class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-red-500 to-red-700">Hour
              Booster</span>
          </div>

          <div class="md:hidden">
            <button onclick="toggleMobileMenu()" class="text-white p-2">
              <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path class="menu-icon" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M4 6h16M4 12h16M4 18h16"></path>
              </svg>
            </button>
          </div>

          <div class="hidden md:flex gap-4">
            <a href="/status">
              <button
                class="bg-white/10 hover:bg-white/20 px-6 py-2 rounded-lg transition-all duration-300">Status</button>
            </a>
            <a href="/dashboard">
              <button
                class="bg-white/10 hover:bg-white/20 px-6 py-2 rounded-lg transition-all duration-300">Dashboard</button>
            </a>
            <a href="/leaderboard">
              <button
                class="bg-white/10 hover:bg-white/20 px-6 py-2 rounded-lg transition-all duration-300">Leaderboard</button>
            </a>
          </div>

          <div id="mobileMenu" class="hidden md:hidden">
            <div class="px-2 pt-2 pb-3 space-y-1 bg-black/50 rounded-lg mt-2">
              <a href="#hero" class="block px-3 py-2 text-white/70 hover:text-white transition-colors">Home</a>
              <a href="#features" class="block px-3 py-2 text-white/70 hover:text-white transition-colors">Features</a>
              <a href="#commands" class="block px-3 py-2 text-white/70 hover:text-white transition-colors">Commands</a>
            </div>
          </div>
        </div>
      </div>
  </nav>

  <!-- Main Content -->
  <main class="pt-32 px-6 max-w-6xl mx-auto">
    <header class="text-center mb-10">
      <h1 class="text-5xl font-extrabold bg-gradient-to-r from-red-500 to-pink-500 text-transparent bg-clip-text drop-shadow">Top Games Leaderboard</h1>
      <p class="text-lg text-white/70 mt-2">Tracking the most boosted and played games</p>
    </header>

    <!-- Sorting Tabs -->
    <div class="flex justify-center mb-6 gap-4 text-sm">
      <button class="tab-btn px-4 py-2 rounded-full bg-white/10 hover:bg-red-500/10 transition" onclick="setSort('boosters', this)">Most Boosters</button>
      <button class="tab-btn px-4 py-2 rounded-full bg-white/10 hover:bg-red-500/10 transition" onclick="setSort('hours', this)">Most Hours</button>
      <button class="tab-btn px-4 py-2 rounded-full bg-white/10 hover:bg-red-500/10 transition" onclick="setSort('least_hours', this)">Least Hours</button>
      <button class="tab-btn px-4 py-2 rounded-full bg-white/10 hover:bg-red-500/10 transition" onclick="setSort('least_boosters', this)">Least Boosters</button>
    </div>

    <!-- Search Bar -->
    <div class="text-center mb-10">
      <input id="searchInput" type="text" placeholder="Search by name or App ID" oninput="renderCards()"
             class="w-full max-w-xl px-4 py-2 rounded-lg bg-white/5 text-white placeholder-white/50 border border-white/20" />
    </div>

    <!-- Leaderboard Table -->
    <section class="rounded-xl border border-white/10 shadow-xl overflow-hidden">
      <div class="grid grid-cols-6 bg-gradient-to-r from-[#16161a] to-[#1f1f24] text-xs text-white/60 font-semibold uppercase px-6 py-3">
        <div>#</div>
        <div class="col-span-2">Game</div>
        <div>Boosters</div>
        <div>Hours</div>
        <div>App ID</div>
      </div>
      <div id="leaderboard-rows" class="divide-y divide-white/10"></div>
    </section>

    <!-- Pagination -->
    <div class="flex justify-center items-center gap-2 mt-8 text-white/80 text-sm">
      <button onclick="changePage('first')" class="px-3 py-1 bg-white/10 hover:bg-white/20 rounded">&laquo;</button>
      <button onclick="changePage(-1)" class="px-3 py-1 bg-white/10 hover:bg-white/20 rounded">&lsaquo;</button>
      <span><span id="page-number">1</span> / <span id="page-total">1</span></span>
      <button onclick="changePage(1)" class="px-3 py-1 bg-white/10 hover:bg-white/20 rounded">&rsaquo;</button>
      <button onclick="changePage('last')" class="px-3 py-1 bg-white/10 hover:bg-white/20 rounded">&raquo;</button>
    </div>
  </main>

  <!-- Footer -->
  <footer class="text-white py-16 border-t border-white/10 mt-20">
    <div class="max-w-7xl mx-auto text-center">
      <p class="text-sm text-white/40">Â© 2025 Hour Booster</p>
    </div>
  </footer>

  <script>
    let players = [];
    let page = 1;
    const perPage = 10;
    const medals = ["ðŸ¥‡", "ðŸ¥ˆ", "ðŸ¥‰"];
    const gem = "ðŸ’Ž";
    let currentSort = 'boosters';
    

    function getBoosterBadgeClass(count) {
      if (count === 0) return 'bg-gray-700 text-gray-300';
      if (count <= 1) return 'bg-blue-400/20 text-blue-300';
      if (count <= 2) return 'bg-purple-400/20 text-purple-300';
      if (count <= 3) return 'bg-pink-400/20 text-pink-300';
      if (count <= 4) return 'bg-red-400/20 text-red-300';
      if (count <= 5) return 'bg-orange-400/20 text-orange-300';
      if (count <= 6) return 'bg-amber-400/20 text-amber-300';
      if (count <= 7) return 'bg-yellow-400/20 text-yellow-300';
      if (count <= 8) return 'bg-lime-400/20 text-lime-300';
      if (count <= 9) return 'bg-green-400/20 text-green-300';
      if (count <= 10) return 'bg-emerald-400/20 text-emerald-300';
      if (count <= 11) return 'bg-teal-400/20 text-teal-300';
      if (count <= 12) return 'bg-cyan-400/20 text-cyan-300';
      if (count <= 13) return 'bg-sky-400/20 text-sky-300';
      if (count <= 14) return 'bg-indigo-400/20 text-indigo-300';
      if (count <= 15) return 'bg-violet-400/20 text-violet-300';
      if (count <= 16) return 'bg-fuchsia-400/20 text-fuchsia-300';
      if (count <= 17) return 'bg-rose-400/20 text-rose-300';
      if (count <= 18) return 'bg-pink-500/20 text-pink-200';
      if (count <= 19) return 'bg-red-500/20 text-red-200';
      return 'bg-gradient-to-r from-yellow-500 to-pink-500 text-white shadow-lg font-semibold animate-pulse';
    }

    let selectedStyle = "classic"; // iconRow / profile card

const layoutStyles = {
  classic: (g, rank) => `
    <div class="text-white/70 font-mono">${rank}</div>
    <div class="col-span-2 flex items-center gap-4 overflow-hidden">
      <img src="${g.background || '/fallback.jpg'}" class="w-20 h-auto rounded shadow shrink-0" />
      <div class="whitespace-nowrap text-ellipsis overflow-hidden text-white font-medium text-sm max-w-[250px] sm:max-w-[350px] lg:max-w-[450px]">
        ${g.name}
      </div>
    </div>

    <div>
    <div class="text-xs inline-block ${getBoosterBadgeClass(g.boosters)} px-2 py-1 rounded-md">${g.boosters} Booster${g.boosters === 1 ? '' : 's'}</div>
    </div>
    <div class="text-white/90 font-mono">${g.hours}</div>
    <div class="text-white/50 font-mono">${g.appId}</div>
  `,

overwatch: (g, rank) => `
  <div class="col-span-5 bg-[#202225] p-4 rounded-lg flex items-center gap-4 border-l-4 border-orange-500">
    <div class="text-orange-400 font-bold text-xl">#${rank}</div>
    <img src="${g.background || '/fallback.jpg'}" class="w-14 h-14 rounded" />
    <div class="flex-1">
      <div class="text-white font-semibold">${g.name}</div>
      <div class="text-xs text-white/50">${g.appId}</div>
    </div>
    <div class="text-green-300 font-mono">${g.hours}</div>
    <div class="text-xs ${getBoosterBadgeClass(g.boosters)} px-2 py-1 rounded">${g.boosters}</div>
  </div>
`,

};




    function setSort(type, btn) {
      document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('border-red-500', 'text-white'));
      btn.classList.add('border-red-500', 'text-white');
      currentSort = type;
      renderCards();
    }

    function renderCards() {
      const container = document.getElementById("leaderboard-rows");
      container.innerHTML = "";

      const search = document.getElementById("searchInput").value.toLowerCase();
      let filtered = players.filter(p =>
        p.name.toLowerCase().includes(search) || String(p.appId).includes(search)
      );

      filtered.sort((a, b) => {
        switch (currentSort) {
          case 'boosters': return b.boosters - a.boosters;
          case 'hours': return b.hours - a.hours;
          case 'least_hours': return a.hours - b.hours;
          case 'least_boosters': return a.boosters - b.boosters;
        }
      });

      const start = (page - 1) * perPage;
      const visible = filtered.slice(start, start + perPage);

      visible.forEach((g, i) => {
        const rank = start + i + 1;
        const boosterClass = getBoosterBadgeClass(g.boosters);

        const row = document.createElement('div');
        row.className = "grid grid-cols-6 px-6 py-4 transition-all hover:bg-white/5";
        row.innerHTML = layoutStyles[selectedStyle](g, rank);
        container.appendChild(row);

        container.appendChild(row);
      });

      document.getElementById("page-number").textContent = page;
      document.getElementById("page-total").textContent = Math.ceil(filtered.length / perPage);
    }

    function changePage(action) {
      const maxPage = Math.ceil(players.length / perPage);
      if (action === 'first') page = 1;
      else if (action === 'last') page = maxPage;
      else {
        page += action;
        if (page < 1) page = 1;
        if (page > maxPage) page = maxPage;
      }
      renderCards();
    }

    window.addEventListener("load", async () => {
      const loader = document.getElementById("loader");
      if (loader) {
        loader.style.opacity = "0";
        loader.style.transition = "opacity 0.5s ease";
        setTimeout(() => loader.remove(), 500);
      }

      const res = await fetch("/api/leaderboard");
      players = await res.json();
      renderCards();
    });
  </script>

</body>
</html>
